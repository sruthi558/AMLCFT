<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      // Check if a success message is provided and display it as a popup
      var successMessage = "{{ success_message }}";
      if (successMessage && successMessage !== "None") {
        alert(successMessage); // You can use a more sophisticated popup library here if needed
      }
    </script>
    

    {% include 'metaData.html' %}


    <style>
      /* date picker start */

      /* Style the input box */
      .form-control-sm {
        width: 200px;
        /* Set your desired width */

        font-size: 14px;
        border: 1px solid #ccc !important;
        border-radius: 4px;
        background-color: rgb(251, 255, 254);
      }
      .form-control {
        border: 1px solid #ccc !important;
      }
      .form-control:hover {
        border: 1px solid #ccc !important;
      }
      tr:not(:first-child):hover {
        transform: none !important;
      }
      .input-group-text {
        padding: 0px 0.75rem;
        font-size: 0.9rem;
      }
      /* Style the placeholder text */
      ::placeholder {
        color: #999;
        /* Customize the placeholder color */
      }

      /* date picker ends*/

      .text-primary {
        color: #00579c !important;
      }
      .form-control-sm:hover {
        border: 1px solid #ced4da !important;
      }

      .btn-primary {
        background-color: #00579c !important;
        border-color: #00579c !important;
      }

      .btn-danger {
        background-color: #df2233 !important;
      }

      .page-item.active .page-link {
        background-color: #00579c !important;
      }

      .layout-px-spacing {
        min-height: calc(100vh - 166px) !important;
      }

      .paths:hover {
        text-decoration: underline;
      }

      #select-all {
        cursor: pointer;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        width: 20px;
        height: 20px;
        background-color: #ffffff;
        border-radius: 50%;
        display: inline-block;
        vertical-align: middle;
      }

      .checkbox {
        cursor: pointer;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        width: 20px;
        height: 20px;
        background-color: #8080805b;
        border-radius: 50%;
        display: inline-block;
        vertical-align: middle;
      }

      .checkbox:checked {
        border: 2px solid rgb(0, 119, 255);
        background: url("../static/assets/img/tick-svgrepo-com.png");
        background-size: 100% 100%;
        /* Make sure the image covers the entire checkbox */
      }

      .checkbox:active {
        border: 2px solid rgb(0, 119, 255);

        background: url("../static/assets/img/tick-svgrepo-com.png");
        /* Set the background image when the checkbox is clicked */
        background-size: 100% 100%;
        /* Make sure the image covers the entire checkbox */
      }

      tr {
        transition: all 0.1s ease-in-out;
      }

      tr:not(:first-child):hover {
        transform: scale(1.01);
      }

      th:first-child::after {
        content: "" !important;
      }

      th:first-child::before {
        content: "" !important;
      }

      td,
      th {
        padding: 8px 15px !important;
        border: none !important;
        border-bottom: 2px solid #00000033 !important;
        text-align: left !important;
      }

      /* .modal-content {} */
    </style>

    <!-- END PAGE LEVEL PLUGINS/CUSTOM STYLES -->
  </head>

  <body>
    <!-- BEGIN LOADER -->
    <div id="load_screen">
      <div class="loader">
        <div class="loader-content">
          <div class="spinner-grow align-self-center"></div>
        </div>
      </div>
    </div>
    <!--  END LOADER -->

    <!--  BEGIN NAVBAR  -->
    {% include 'header.html' %}

    <!--  END NAVBAR  -->

    <!--  BEGIN NAVBAR  -->
    <div class="sub-header-container">
      <header class="header navbar navbar-expand-sm">
        <a
          href="javascript:void(0);"
          class="sidebarCollapse"
          data-placement="bottom"
          ><svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="feather feather-menu"
          >
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </a>

        <ul class="navbar-nav flex-row" style="gap: 10px">
          <li>
            <div class="page-header">
              <div class="page-title">
                <nav class="breadcrumb-one" aria-label="breadcrumb">
                  <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                      <a
                        href="{{ url_for('ITdashboard') }}"
                        class="text-blue font-weight-bold"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="24"
                          height="24"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          class="feather feather-home"
                        >
                          <path
                            d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                          ></path>
                          <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                      </a>
                    </li>
                  </ol>
                </nav>
              </div>
            </div>
          </li>
          <li>
            <a href="{{url_for('tenlakcollection')}}" class="text-primary"
              >/ <span class="paths">CASHMAP Transaction Data</span></a
            >
          </li>
          <li>
            <a
              href="{{url_for('tenlakcollectionPreview')}}"
              class="text-primary"
              >/ <span class="paths">CASHMAP Transaction Data</span></a
            >
          </li>
        </ul>
      </header>
    </div>
    <!--  END NAVBAR  -->

    <!--  BEGIN CONTENT PART  -->
    <!--  BEGIN MAIN CONTAINER  -->
    <div class="main-container" id="container">
      <div class="overlay"></div>
      <div class="search-overlay"></div>

      <!--  BEGIN SIDEBAR  -->
      {% include 'sidebar.html' %}

      <!--  END SIDEBAR  -->

      <!--  BEGIN CONTENT AREA  -->
      <div id="content" class="main-content">
        <div class="layout-px-spacing">
          <div
            class="alert alert-success position-relative"
            role="alert"
            style="right: 0; top: 1%; display: none"
            id="sucessAlert"
          >
            Successfully Submited...
          </div>
          <div class="layout-top-spacing">
            <!-- <div id="content" class="main-content">
                                          <div class="layout-px-spacing"> -->

            <div class="row layout-top-spacing layout-spacing">
              <div class="col-lg-12">
                <div class="statbox widget box box-shadow">
                  <div class="border rounded shadow-sm">
                    <div class="row m-1 justify-content-center">
                      <div class="col-lg-4 mt-3">
                        <div class="btn-group submitter-group">
                          <div class="input-group-prepend">
                            <div class="input-group-text">Customer Id</div>
                          </div>
                          <input
                            type="text"
                            class="filter-checkbox form-control-sm"
                            id="custId"
                            placeholder="Enter Customer Id..."
                          />
                        </div>
                      </div>
                      <div class="col-lg-4 mt-3">
                        <div class="btn-group submitter-group">
                          <div class="input-group-prepend">
                            <div class="input-group-text">
                              MIN Violated Amount
                            </div>
                          </div>
                          <input
                            type="number"
                            class="filter-checkbox form-control-sm"
                            id="minViolatedAmount"
                            placeholder="Enter min Violated Amount..."
                          />
                        </div>
                        <h6 class="text-center m-1">To</h6>
                        <div class="btn-group submitter-group">
                          <div class="input-group-prepend">
                            <div class="input-group-text">
                              MAX Violated Amount
                            </div>
                          </div>
                          <input
                            type="number"
                            class="filter-checkbox form-control-sm"
                            id="maxViolatedAmount"
                            placeholder="Enter max Violated Amount..."
                          />
                        </div>
                      </div>
                      <div class="col-lg-4 mt-4">
                        <div class="btn-group submitter-group">
                          <div class="input-group-prepend">
                            <div class="input-group-text">Account Number</div>
                          </div>
                          <input
                            type="text"
                            class="filter-checkbox form-control-sm"
                            id="AccountNumber"
                            placeholder="Enter Account Number..."
                          />
                        </div>
                      </div>
                      <div class="col-lg-4 mt-3">
                        <div class="btn-group">
                          <div class="input-group-prepend">
                            <div class="input-group-text">Branch</div>
                          </div>
                          <select class="form-control-sm" id="Branch">
                            <option value="">All</option>
                            <option value="Panjaguta">Panjaguta</option>
                            <option value="Kukatpali">Kukatpali</option>
                            <option value="KPHB">KPHB</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-lg-4 mt-3 d-none">
                        <div class="btn-group submitter-group">
                          <div class="input-group-prepend">
                            <div class="input-group-text">Date</div>
                          </div>
                          <input
                            id="rangeCalendarFlatpickr"
                            class="form-control-sm flatpickr flatpickr-input active"
                            type="text"
                            style="background-color: transparent !important"
                            placeholder="Select Date Range.."
                          />
                        </div>
                      </div>
                      <div class="col-lg-4 mt-3">
                        <div class="btn-group submitter-group">
                          <div class="input-group-prepend">
                            <div class="input-group-text">Account Type</div>
                          </div>
                          <select
                            class="form-control-sm status-dropdown"
                            id="AccType"
                          >
                            <option value="">All</option>
                            <option value="Current Account">
                              Current Account
                            </option>
                            <option value="Savings Account">
                              Savings Account
                            </option>
                          </select>
                        </div>
                      </div>
                    </div>
                    <div class="col-12 text-center mt-1 mb-2">
                      <button
                        id="filter-button"
                        class="btn btn-sm btn-blue mt-3"
                      >
                        Apply Filters
                      </button>
                    </div>
                  </div>

                  <div
                    class="d-flex flex-column align-items-center widget-content widget-content-area justify-content-center pb-0 pt-0"
                    data-backdrop="false"
                    style="position: relative; z-index: 852px; top: 0"
                  ></div>

                  <div class="widget-content widget-content-area">
                    <div class="table-responsive mb-4">
                      <section>
                        <table
                          id="example"
                          class="display nowrap"
                          style="width: 100%"
                        >
                          <thead>
                            <tr>
                              <th>Account<br />Number</th>
                              <th class="">
                                Customer<br />
                                No
                              </th>
                              <th class="d-none">Branch</th>
                              <th class="d-none">Allocated Date</th>
                              <th class="d-none">Account Type</th>
                              <th>
                                Overall Risk<br />
                                Rating
                              </th>
                              <th>Scenarios <br />violated</th>
                              <th>No.of <br />Transactions</th>
                              <th>Violation Amount</th>
                            </tr>
                          </thead>
                          <tbody id="tableBody">
                            {% for resultData in data %}

                            <tr>
                              {% if 'Account Number' in resultData %}
                              <td>{{resultData['Account Number']}}</td>
                              {% else %}
                              <td>-</td>
                              {% endif %} {% if 'Customer ID' in resultData %}
                              <td>{{resultData['Customer ID']}}</td>
                              {% else %}
                              <td>-</td>
                              {% endif %} {% if 'Branch' in resultData %}
                              <td class="d-none">{{resultData['Branch']}}</td>
                              {% else %}
                              <td class="d-none">Kukatpali</td>
                              {% endif %} {% if 'alert_allocated_on' in
                              resultData %}
                              <td class="d-none">
                                {{resultData['alert_allocated_on']}}
                              </td>
                              {% else %}
                              <td class="d-none">--</td>
                              {% endif %} {% if 'Type of account' in resultData
                              %}
                              <td class="d-none">
                                {{resultData['Type of account']}}
                              </td>
                              {% else %}
                              <td class="d-none">----</td>
                              {% endif %} {% if 'Risk Rating' in resultData %}
                              <td>{{resultData['Risk Rating']}}</td>
                              {% else %}
                              <td>Medium</td>
                              {% endif %} {% if 'Scenarios Violated' in
                              resultData %}
                              <td>{{resultData['Scenarios Violated']}}</td>
                              {% else %}
                              <td>1</td>
                              {% endif %} {% if 'Transactions Number' in
                              resultData %}
                              <td>{{resultData['Transactions Number']}}</td>
                              {% else %}
                              <td>1</td>
                              {% endif %} {% if 'Transaction Amount' in
                              resultData %}
                              <td>{{resultData['Transaction Amount']}}</td>
                              {% else %}
                              <td>-</td>
                              {% endif %}
                            </tr>
                            {% endfor %}

                            <!-- Add more rows with your own data as needed -->
                          </tbody>
                        </table>
                      </section>

                      <!-- modal  -->

                      <!-- Button trigger modal -->

                      <!--  END CONTENT AREA  -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% include 'footer.html' %}
      </div>
    </div>
    <!-- END MAIN CONTAINER -->

    <!-- BEGIN GLOBAL MANDATORY SCRIPTS -->
    <script src="../static/assets/js/libs/jquery-3.1.1.min.js"></script>
    <script src="../static/bootstrap/js/popper.min.js"></script>
    <script src="../static/bootstrap/js/bootstrap.min.js"></script>
    <script src="../static/plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="../static/assets/js/app.js"></script>

    <!-- viwe JS start -->

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/js/bootstrap.min.js"></script>

    <!-- viwe JS ends -->

    <script
      type="text/javascript"
      language="javascript"
      src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"
    ></script>
    <script
      type="text/javascript"
      language="javascript"
      src="https://cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"
    ></script>
    <script>
      $(document).ready(function () {
        App.init();
      });
    </script>
    <script>
      $(document).ready(function () {
        $("#usersTab").click(function () {
          $("#addUserTab, #allUsersTab").toggle();
        });
      });
    </script>
    <script src="../static/assets/js/custom.js"></script>
    <!-- END GLOBAL MANDATORY SCRIPTS -->

    <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->
    <script src="../static/plugins/apex/apexcharts.min.js"></script>

    <script src="../static/assets/js/dashboard/dash_1.js"></script>

    <!-- <script src="../static/assets/js/tables.js/tableCheckBox.js"></script> -->
    <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->

    <script src="../static/plugins/table/datatable/datatables.js"></script>

    <script
      type="text/javascript"
      language="javascript"
      src="https://cdn.datatables.net/responsive/2.3.0/js/dataTables.responsive.min.js"
    ></script>

    <!-- <script>
    // Add an event listener for the "View" button click
    $(document).ready(function () {
        $('#tableBody').on('click', '#view', function () {
            // Get the data associated with the clicked row
            var ticketData = $(this).closest('tr').find('.ticket-data').text();

            // Display the data in the modal
            $('#modalContent').text(ticketData);

            // Show the modal
            var modalId = $(this).data('bs-target');
            $(modalId).modal('show');
        });
    });
</script> -->

    <script>
      // date picker Starts

      document.addEventListener("DOMContentLoaded", function () {
        var isDateFiltering = false;
        var dataTable;
        var dateArr = [];

        // Initialize DataTable
        $(document).ready(function () {
          dataTable = $("#example").DataTable({
            rowReorder: {
              selector: "td:nth-child(1)",
            },
            responsive: true,
            paging: false, // Disable initial pagination
            scrollY: "300px", // Set the height of the scrollable area
            scrollCollapse: true, // Enable the scrollbar to collapse
            scrollInfinite: true, // Enable infinite scrolling
            info: true,

            // "columnDefs": [

            //   {
            //     "targets": [8],
            //     "visible": false
            //   }
            // ]
          });

          function datePicker() {
            // Get a reference to the input element
            var dateRangeInput = document.getElementById(
              "rangeCalendarFlatpickr"
            );
            // Initialize flatpickr with date range configuration and the onChange event
            return flatpickr(dateRangeInput, {
              mode: "range", // This enables date range selection
            });
          }
          function filterTableByDateRange(startDate, endDate) {
            var amou = false;
            var table = document.getElementById("tableBody");
            var rows = table.getElementsByTagName("tr");
            // Show all rows when the date range is empty
            if (!startDate || !endDate) {
              for (var i = 0; i < rows.length; i++) {
                rows[i].style.display = "";
              }
              return; // Exit the function when the date range is empty
            }
            for (var i = 0; i < rows.length; i++) {
              var row = rows[i];
              var dateCell_undef = row.getElementsByTagName("td")[2]; // Assuming the date is in the 5th index
              var dateCell = dateCell_undef.textContent;
              if (dateCell) {
                var dateTimeParts = dateCell.split(" ");
                var dateParts = dateTimeParts[0].split("-");
                var timeParts = dateTimeParts[1].split(":");
                var day = parseInt(dateParts[2], 10);
                var month = parseInt(dateParts[1], 10) - 1; // Months are zero-based
                var year = parseInt(dateParts[0], 10);
                var hours = parseInt(timeParts[0], 10);
                var minutes = parseInt(timeParts[1], 10);
                var seconds = parseInt(timeParts[2], 10);
                var rowDate = new Date(
                  year,
                  month,
                  day,
                  hours,
                  minutes,
                  seconds
                );
                if (rowDate >= startDate && rowDate <= endDate) {
                  row.style.display = "";
                  amou = true;
                  console.log(" IN RANGE DATES");
                } else {
                  row.style.display = "none";
                  amou = false;
                  console.log("NOT IN RANGE DATES");
                }
              }
            }
            return amou;
          }
          // Example usage:
          var flatpickrInstance = datePicker();
          // Bind applyFilters function to button click
          $("#filter-button").on("click", function () {
            applyFilters();

            var minViolatedAmount =
              document.getElementById("minViolatedAmount").value;
            var maxViolatedAmount =
              document.getElementById("maxViolatedAmount").value;

            // Get the selected dates from the flatpickr instance
            var selectedDates = flatpickrInstance.selectedDates;
            // If a date range is selected, filter the table
            if (selectedDates.length === 2) {
              var startDate = selectedDates[0];
              var endDate = selectedDates[1];
              var dece = filterTableByDateRange(startDate, endDate);

              if (
                dece &&
                minViolatedAmount.length != 0 &&
                maxViolatedAmount.length != 0
              ) {
                filterTableByViolationAmounts(
                  minViolatedAmount,
                  maxViolatedAmount
                );
              }
            } else if (
              minViolatedAmount.length != 0 &&
              maxViolatedAmount.length != 0
            ) {
              console.log("minViolatedAmount : ", minViolatedAmount);
              console.log("maxViolatedAmount : ", maxViolatedAmount);

              filterTableByViolationAmounts(
                minViolatedAmount,
                maxViolatedAmount
              );
            } else {
              // Handle the case where the date range is not selected

              console.log("Please select a date range");
              var table = document.getElementById("tableBody");
              var rows = table.getElementsByTagName("tr");
              // Show all rows when the date range is empty
              for (var i = 0; i < rows.length; i++) {
                rows[i].style.display = "";
              }
              return; // Exit the function when the date range is empty
            }
          });
        });

        // Apply filters function
        function applyFilters() {
          console.log(dateArr);

          var custId = $("#custId").val();
          // var violatedAmount = $('#ViolatedAmount').val();
          var accountNumber = $("#AccountNumber").val();
          var branch = $("#Branch").val();
          var accounttype = $("#AccType").val();

          // Clear existing search
          dataTable.columns().search("");

          // Apply filters
          dataTable
            .columns(0)
            .search(accountNumber)
            .columns(1)
            .search(custId)
            .columns(2)
            .search(branch)
            .column(4)
            .search(accounttype);

          // Filter based on dateArr
          dataTable.column(3).search("").draw();

          dateArr.forEach(function (date) {
            dataTable.column(3).search(date).draw();
          });
        }
      });

      function filterTableByViolationAmounts(
        minViolatedAmount,
        maxViolatedAmount
      ) {
        var table = document.getElementById("tableBody");
        var rows = table.getElementsByTagName("tr");

        for (var i = 0; i < rows.length; i++) {
          var row = rows[i];
          console.log("this is amount range : ", row);
          var dateCell_undef = row.getElementsByTagName("td")[8]; // Assuming the date is in the 5th index
          var amountCell = dateCell_undef.textContent;
          console.log(amountCell);
          amountCell = Number(amountCell);

          console.log("Parsed amountCell:", amountCell);
          console.log("minViolatedAmount:", minViolatedAmount);
          console.log("maxViolatedAmount:", maxViolatedAmount);

          if (
            !isNaN(amountCell) &&
            amountCell >= minViolatedAmount &&
            amountCell <= maxViolatedAmount
          ) {
            row.style.display = "";
            console.log(" IN RANGE DATES");
          } else {
            row.style.display = "none";
            console.log("NOT IN RANGE DATES");
          }
        }
      }

      function submitForm() {
        // Find the parent form and submit it
        var form = event.target.closest("form");
        form.submit();
      }
    </script>
    <!-- <script>
      $(document).ready(function () {
          var isNavigatingAway = false;
    
          // Update the user's active status every minute
          setInterval(function () {
              if (!isNavigatingAway) {
                  $.ajax({
                      type: "POST",
                      url: "/update_active_status",
                      success: function (response) {
                          console.log("Active status updated");
                      },
                      error: function (xhr, status, error) {
                          console.error("Error updating active status:", error);
                      }
                  });
              }
          }, 60000); // 1 minute interval
    
          // Add event listener for click events on links
          $(document).on('click', 'a', function () {
              isNavigatingAway = true;
          });
    
          // Add event listener for form submit events
          $(document).on('submit', 'form', function () {
              isNavigatingAway = true;
          });
    
          // Send a Beacon request when the tab is closed
          window.addEventListener('pagehide', function () {
              if (!isNavigatingAway) {
                  navigator.sendBeacon('/update_status');
                  console.log("Status updated to null via Beacon");
              }
          });
          
      });
    
    </script> -->
  </body>
</html>
