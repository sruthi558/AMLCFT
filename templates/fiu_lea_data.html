<!DOCTYPE html>
<html lang="en">

<head>
    <script>
        // Check if a success message is provided and display it as a popup
        var successMessage = "{{ success_message }}";
        if (successMessage && successMessage !== 'None') {
            alert(successMessage);  // You can use a more sophisticated popup library here if needed
        }
    </script>

{% include 'metaData.html' %}

  
  <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM STYLES -->

  <style>
    /* date picker start */

    /* Style the input box */
    .form-control-sm {
      width: 200px;
      /* Set your desired width */
     
      font-size: 14px;
      border: 1px solid #ccc!important;
      border-radius: 4px;
      background-color: rgb(251, 255, 254);
    }
    .form-control {
      border: 1px solid #ccc!important;
    }
    .form-control:hover {
      border: 1px solid #ccc!important;
    }
    tr:not(:first-child):hover {
    transform: none!important;
  }
    .input-group-text {
    
    padding: 0px 0.75rem;
    font-size: 0.9rem;
}
    /* Style the placeholder text */
    ::placeholder {
      color: #999;
      /* Customize the placeholder color */
    }
    
    /* date picker ends*/

    .text-primary {
      color: #00579c !important;
    }
  .form-control-sm:hover {
    border: 1px solid #ced4da !important;
}

    .btn-primary {
      background-color: #00579c !important;
      border-color: #00579c !important;
    }

    .btn-danger {
      background-color: #df2233 !important;
    }

    .page-item.active .page-link {
      background-color: #00579c !important;
    }

    .layout-px-spacing {
      min-height: calc(100vh - 166px) !important;
    }

    .paths:hover {
      text-decoration: underline;
    }

    #select-all {
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      width: 20px;
      height: 20px;
      background-color: #ffffff;
      border-radius: 50%;
      display: inline-block;
      vertical-align: middle;
    }

    .checkbox {
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      width: 20px;
      height: 20px;
      background-color: #8080805b;
      border-radius: 50%;
      display: inline-block;
      vertical-align: middle;
    }

    .checkbox:checked {
      border: 2px solid rgb(0, 119, 255);
      background: url('../static/assets/img/tick-svgrepo-com.png');
      background-size: 100% 100%;
      /* Make sure the image covers the entire checkbox */
    }

    .checkbox:active {
      border: 2px solid rgb(0, 119, 255);

      background: url('../static/assets/img/tick-svgrepo-com.png');
      /* Set the background image when the checkbox is clicked */
      background-size: 100% 100%;
      /* Make sure the image covers the entire checkbox */
    }

    tr {
      transition: all 0.1s ease-in-out;
    }

    tr:not(:first-child):hover {
      transform: scale(1.01);
    }

    th:first-child::after {
      content: "" !important;
    }

    th:first-child::before {
      content: "" !important;
    }

    td,
    th {
      padding: 8px 15px !important;
      border: none !important;
      border-bottom: 2px solid #00000033 !important;
      text-align: left !important;
    }

    /* .modal-content {} */
  </style>

  <!-- END PAGE LEVEL PLUGINS/CUSTOM STYLES -->
</head>

<body>
  <!-- BEGIN LOADER -->
  <div id="load_screen">
    <div class="loader">
      <div class="loader-content">
        <div class="spinner-grow align-self-center"></div>
      </div>
    </div>
  </div>
  <!--  END LOADER -->

  <!--  BEGIN NAVBAR  -->
 {% include 'header.html' %}
  <!--  END NAVBAR  -->

  <!--  BEGIN NAVBAR  -->
  <div class="sub-header-container">
    <header class="header navbar navbar-expand-sm">
      <a href="javascript:void(0);" class="sidebarCollapse" data-placement="bottom"><svg
          xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="feather feather-menu">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </a>

      <ul class="navbar-nav flex-row" style="gap: 10px;">
        <li>
          <div class="page-header">
            <div class="page-title">
              <nav class="breadcrumb-one" aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="{{ url_for('ITdashboard') }}"
                      class="text-blue font-weight-bold">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="feather feather-home">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                      </svg>
                    </a></li>
                </ol>
              </nav>
            </div>
          </div>
        </li>
        <li>
          <a href="{{url_for('fiu_lea')}}" class="text-primary">/ <span class="paths ">{{heading}}</span></a>

        </li>
      </ul>
    </header>
  </div>
  <!--  END NAVBAR  -->

      <!--  BEGIN CONTENT PART  -->
       <!--  BEGIN MAIN CONTAINER  -->
    <div class="main-container" id="container">

        <div class="overlay"></div>
        <div class="search-overlay"></div>

        <!--  BEGIN SIDEBAR  -->
       {% include 'sidebar.html' %}
    <!--  END SIDEBAR  -->

    <!--  BEGIN CONTENT AREA  -->
    <div id="content" class="main-content">
      <div class="layout-px-spacing">

        <div class="alert alert-success position-relative" role="alert" style="right: 0; top: 1%;display: none;" id="sucessAlert">
          Successfully Submited...
        </div>
        <div class=" layout-top-spacing">





          <!-- <div id="content" class="main-content">
                                          <div class="layout-px-spacing"> -->

          <div class="row layout-top-spacing layout-spacing">
            <div class="col-lg-12 ">
              <div class="statbox widget box box-shadow">

                
                <!-- <div class="form-group mb-0 widget-content widget-content-area pb-0 "
                style="display: flex;justify-content: end;align-items: center;gap: 10px;">
                <label style="font-size:20px;font-weight:500;color: #8e949d;text-wrap: nowrap;" class="mt-2">Date : </label>
                <input id="rangeCalendarFlatpickr" class="form-control flatpickr flatpickr-input active" type="text" style="background-color: transparent !important;"
                  placeholder="Select Date Range.." />
              </div> -->
                <div class="widget-content widget-content-area">
                    <div class="justify-content-center row">
                    <div class="shadow col-4 bg-gradient rounded text-center mb-5">
                   
                     
                   
                    </div>
                    </div>


                  <div class="table-responsive mb-4 ">

                    <section>
                      
                      <table id="example" class="display nowrap" style="width: 100%">
                        <thead>
                          <tr>
                           
                             <th class="d-none">ID</th> 
                             <th> Account Number</th>
                            
                            <th>Customer ID</th>
                           
                            <th>Amount</th>
                            <th>View</th>
                            

                          
                           
                         

                          </tr>
                        </thead>
                          <tbody id="tableBody">
                             {% for data in result_data %}
                              <tr>
                               <td class="d-none">{{ data.ticket_id}}</td> 
                                
                                 <td>{{ data['Account Number'] }}</td>
                                 <td>{{ data['Customer ID']}}</td>
                                 <td>{{data['Transaction Amount']}}</td>
                                 
                                  <!-- <td>
                            {% if 'Case_Details' in data and 'Investigation' in data['Case_Details'] %}
                                {{ data['Case_Details']['Investigation'] }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td> -->

                        <td><button class="btn btn-blue btn-sm" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal{{ data.ticket_id}}">View</button></td>
                   

                        <!-- Modal -->
                                <div class="modal fade" id="exampleModal{{ data.ticket_id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">{{ data['Customer ID']}}</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                       <b>Account Number :</b> {{ data['Account Number'] }}<br/>
                                       <b>Transaction Amount :</b> {{ data['Transaction Amount'] }}<br/>
                                       <b>Transaction Date :</b> {{ data['Transaction Date'] }}<br/>
                                       <b>Transaction Type :</b> {{ data['Transaction Type'] }}<br/>
                                      <b>Transaction Category :</b> {{ data['Transaction Category'] }}<br/>
                                       <b>scenario_code :</b> {{ data['scenario_code'] }}<br/>
                                       <b>Investigation :</b> {{ data['Case_Details']['Investigation'] }}<br/>
                                      <b>Suspicious Due Proceed Of Crime :</b> {{ data['Case_Details']['SuspeciousDuoCrime'] }}<br/>
                                       <b>Classification :</b> {{ data['Case_Details']['Classification'] }}<br/>
                                      <b>Suspicious Due Complex Transaction :</b> {{ data['Case_Details']['SuspeciousDuoComplexTr'] }}<br/>
                                       <b>Suspicious Due To Terrorism Financing :</b> {{ data['Case_Details']['terrorisumFunding'] }}<br/>
                                      <b>Suspicious Due No-economical Rational :</b> {{ data['Case_Details']['SuspeciousDuoCrime'] }}<br/>
                                      
                                      <b>LEA Informed :</b> {{ data['Case_Details']['LEAinformed'] }}<br/>
                                       <b>LEA Details :</b> {{ data['Case_Details']['LEADetails'] }}<br/>
                                      <b>Report Covers :</b> {{ data['Case_Details']['reportCase'] }}<br/>

                                       <b>Additional Due Sent :</b> {{ data['Case_Details']['additionalInfo'] }}<br/>
                                       <b>PRIORITY RA'G :</b> {{ data['Case_Details']['priorityRAG'] }}<br/>
                                      <b>Cumulative CRT Turnover :</b> {{ data['Case_Details']['cumulativeCrtTurnover'] }}<br/>
                                       <b>Cumulative DT Turnover :</b> {{ data['Case_Details']['cumulativeDTTurnover'] }}<br/>
                                      <b>Cumulative Deposit Turnover :</b> {{ data['Case_Details']['cumulativeDepositTurnover'] }}<br/>

                                       <b>Cumulative Withdrawal Turnover :</b> {{ data['Case_Details']['cumulativeWithdrawalTurnover'] }}<br/>
                                      <b>No Of Transaction To Be Reported :</b> {{ data['Case_Details']['NumTransactionReport'] }}<br/>
                                     
                                       {% if user_role == 'DGM/PO' %}

                                      {% if data['Case_Details']['Raise_STR'] == 'STR' %}
                                       
                                        <b>Status :</b>   <span class="text-danger">Case was created</span>
                                        <!-- Additional details can be added here -->
                                        {% endif %}
                                     {% endif %}
                                      
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                                        
                                        
                                        {% if user_role == 'DGM/PO' %}
                                            <form method="POST" action="{{ url_for('lea_update') }}">
                                                 <button type="submit" class="btn btn-blue">Approve</button>
                                                
                                                 <input type="hidden" name="ticket_id" value="{{ data.ticket_id }}">
                                                  <input type="hidden" name="status" value="Approved">
                                                   <input type="hidden" name="source_page" value="lea_data">
                                              </form>
                                           
                                        {% endif %}
                                    </div>
                                    </div>
                                </div>
                                 
                                 
                                  <!-- Add more data columns as needed -->
                              </tr>
                          {% endfor %}
                            <!-- Add more rows with your own data as needed -->
                          </tbody>

                      </table>

                     
                    </section>

                   


                   

                  </div>
                </div>
              </div>
        </div>
      </div>
      
        
    </div>
    </div>
    {% include 'footer.html' %}
                  <!-- END MAIN CONTAINER -->



                  <!-- BEGIN GLOBAL MANDATORY SCRIPTS -->
                  <script src="../static/assets/js/libs/jquery-3.1.1.min.js"></script>
                  <script src="../static/bootstrap/js/popper.min.js"></script>
                  <script src="../static/bootstrap/js/bootstrap.min.js"></script>
                  <script src="../static/plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>
                  <script src="../static/assets/js/app.js"></script>

                  <!-- viwe JS start -->

                  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
                    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
                    crossorigin="anonymous"></script>
                  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/js/bootstrap.min.js"></script>


                  <!-- viwe JS ends -->


                  <script type="text/javascript" language="javascript"
                    src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
                  <script type="text/javascript" language="javascript"
                    src="https://cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>
                  <script>
                    $(document).ready(function () {
                      App.init();
                    });


                  </script>
                   <script>
                    $(document).ready(function () {
                        $('#usersTab').click(function () {
                            $('#VerifyUserTab').toggle();
                        });
                    });
                </script>
                  <script src="../static/assets/js/custom.js"></script>
                  <!-- END GLOBAL MANDATORY SCRIPTS -->

                  <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->
                  <script src="../static/plugins/apex/apexcharts.min.js"></script>

                  <script src="../static/assets/js/dashboard/dash_1.js"></script>

                  <!-- <script src="../static/assets/js/tables.js/tableCheckBox.js"></script> -->
                  <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->

                  <script src="../static/plugins/table/datatable/datatables.js"></script>
                  <script
                  type="text/javascript"
                  language="javascript"
                  src="https://cdn.datatables.net/responsive/2.3.0/js/dataTables.responsive.min.js"
                ></script>

                  <script>

document.addEventListener("DOMContentLoaded", function () {
  var dataTable;
  var flatpickrInstance;
  // Initialize DataTable
  dataTable = $("#example").DataTable({
    rowReorder: {
      selector: "td:nth-child(2)",
    },
    responsive: true,
    paging: false,
    scrollY: "300px",
    scrollCollapse: true,
    scrollInfinite: true,
    info: true,
  });
  dataTable = $("#example1").DataTable({
    rowReorder: {
      selector: "td:nth-child(2)",
    },
    responsive: true,
    paging: false,
    scrollY: "300px",
    scrollCollapse: true,
    scrollInfinite: true,
    info: true,
  });
  // Initialize Flatpickr for date range selection
  flatpickrInstance = datePicker();
  // Bind applyFilters function to button click
  $('#filter-button').on('click', function () {
    applyFilters();
  });
  function datePicker() {
    // Get a reference to the input element
    var dateRangeInput = document.getElementById('rangeCalendarFlatpickr');
    // Initialize flatpickr with date range configuration
    return flatpickr(dateRangeInput, {
      mode: "range", // This enables date range selection
    });
  }
  // Apply filters function
  function applyFilters() {
    var custId = $('#custId').val();
    var accountNumber = $('#AccountNumber').val();
    var scenario = $('#Scenario').val();
    // Get selected date range
    var selectedDates = flatpickrInstance.selectedDates;
    var startDate = selectedDates ? selectedDates[0] : null;
    var endDate = selectedDates ? selectedDates[1] : null;
    // Clear existing search
    dataTable.columns().search('');
    // Apply filters
    if (custId) {
      dataTable.column(1).search(custId);
    }
    if (accountNumber) {
      dataTable.column(21).search(accountNumber);
    }
    if (scenario) {
      dataTable.column(4).search(scenario);
    }
    // Apply date range filter
    if (startDate && endDate) {
      filterTableByDateRange(startDate, endDate);
    }
    // Redraw the DataTable
    dataTable.draw();
  }
  function filterTableByDateRange(startDate, endDate) {
    var table = $("#example").DataTable();
    // Use DataTable API to get all rows
    table.rows().every(function () {
      var row = this.node();
      var dateCell = this.data()[14]; // Assuming the date is in the 15th column (index 14)
      if (dateCell) {
        var rowDate = new Date(dateCell);
        if (rowDate >= startDate && rowDate <= endDate) {
          row.style.display = "";
        } else {
          row.style.display = "none";
        }
      }
      return true;
    });
    // Redraw the DataTable after filtering
    table.draw();
  }
});

                  </script>
                  
                  <!-- <script>
                    $(document).ready(function () {
                        var isNavigatingAway = false;
                  
                        // Update the user's active status every minute
                        setInterval(function () {
                            if (!isNavigatingAway) {
                                $.ajax({
                                    type: "POST",
                                    url: "/update_active_status",
                                    success: function (response) {
                                        console.log("Active status updated");
                                    },
                                    error: function (xhr, status, error) {
                                        console.error("Error updating active status:", error);
                                    }
                                });
                            }
                        }, 60000); // 1 minute interval
                  
                        // Add event listener for click events on links
                        $(document).on('click', 'a', function () {
                            isNavigatingAway = true;
                        });
                  
                        // Add event listener for form submit events
                        $(document).on('submit', 'form', function () {
                            isNavigatingAway = true;
                        });
                  
                        // Send a Beacon request when the tab is closed
                        window.addEventListener('pagehide', function () {
                            if (!isNavigatingAway) {
                                navigator.sendBeacon('/update_status');
                                console.log("Status updated to null via Beacon");
                            }
                        });
                        
                    });
                  
                  </script> -->
</body>

</html>