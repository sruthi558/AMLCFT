<!DOCTYPE html>
<html lang="en">

<head>
  <script>
        // Check if a success message is provided and display it as a popup
        var successMessage = "{{ success_message }}";
        if (successMessage && successMessage !== 'None') {
            alert(successMessage);  // You can use a more sophisticated popup library here if needed
        }
    </script>
  
  {% include 'metaData.html' %}


  <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM STYLES -->

  <style>
     /* date picker start */

 /* Style the input box */


 .form-control-sm {
      width: 180px;
      margin-left: 5px;
      margin-right: 15px;
      /* Set your desired width */
     
      font-size: 14px;
      border: 1px solid #ccc!important;
      border-radius: 4px;
      background-color: rgb(251, 255, 254);
    }

 .form-control {
      border: 1px solid #ccc!important;
    }
    .form-control:hover {
      border: 1px solid #ccc!important;
    }
    tr:not(:first-child):hover {
    transform: none!important;
  }
    .input-group-text {
    
    padding: 0px 0.75rem;
    font-size: 0.9rem;
}
    /* Style the placeholder text */
    ::placeholder {
      color: #999;
      /* Customize the placeholder color */
    }



/* date picker ends*/
    .text-primary {
      color: #00579c !important;
    }

    .btn-primary {
      background-color: #00579c !important;
      border-color: #00579c !important;
    }

    .btn-danger {
      background-color: #df2233 !important;
    }

    .page-item.active .page-link {
      background-color: #00579c !important;
    }

    .layout-px-spacing {
      min-height: calc(100vh - 166px) !important;
    }

    .paths:hover {
      text-decoration: underline;
    }

    #select-all {
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      width: 20px;
      height: 20px;
      background-color: #ffffff;
      border-radius: 50%;
      display: inline-block;
      vertical-align: middle;
    }

    .checkbox {
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      width: 20px;
      height: 20px;
      background-color: #8080805b;
      border-radius: 50%;
      display: inline-block;
      vertical-align: middle;
    }

    .checkbox:checked {
      border: 2px solid rgb(0, 119, 255);
      background: url('../static/assets/img/tick-svgrepo-com.png');
      background-size: 100% 100%;
      /* Make sure the image covers the entire checkbox */
    }

    .checkbox:active {
      border: 2px solid rgb(0, 119, 255);

      background: url('../static/assets/img/tick-svgrepo-com.png');
      /* Set the background image when the checkbox is clicked */
      background-size: 100% 100%;
      /* Make sure the image covers the entire checkbox */
    }

    tr {
      transition: all 0.1s ease-in-out;
    }

    tr:not(:first-child):hover {
      transform: scale(1.01);
    }

    th:first-child::after {
      content: "" !important;
    }

    th:first-child::before {
      content: "" !important;
    }

    td,
    th {
      padding: 15px !important;
      border: none !important;
      border-bottom: 2px solid #00000033 !important;
      text-align: left !important;
    }

    /* .modal-content {} */
  </style>

  <!-- END PAGE LEVEL PLUGINS/CUSTOM STYLES -->
</head>

<body>
  <!-- BEGIN LOADER -->
  <div id="load_screen">
    <div class="loader">
      <div class="loader-content">
        <div class="spinner-grow align-self-center"></div>
      </div>
    </div>
  </div>
  <!--  END LOADER -->

  <!--  BEGIN NAVBAR  -->
  {% include 'header.html' %}

  <!--  END NAVBAR  -->

  <!--  BEGIN NAVBAR  -->
  <div class="sub-header-container">
    <header class="header navbar navbar-expand-sm">
      <a href="javascript:void(0);" class="sidebarCollapse" data-placement="bottom"><svg
          xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="feather feather-menu">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </a>

      <ul class="navbar-nav flex-row" style="gap: 10px;">
        <li>
          <div class="page-header">
            <div class="page-title">
              <nav class="breadcrumb-one" aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="{{ url_for('CM_SM_NextLevel') }}"
                      class="text-blue font-weight-bold">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="feather feather-home">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                      </svg>
                    </a></li>
                </ol>
              </nav>
            </div>
          </div>
        </li>
        <li>
          <a href="#" class="text-primary">/ <span class="paths ">Pending Cases</span></a>

        </li>
      </ul>
    </header>
  </div>
  <!--  END NAVBAR  -->



  <!--  BEGIN CONTENT PART  -->
  <!--  BEGIN MAIN CONTAINER  -->
  <div class="main-container" id="container">

    <div class="overlay"></div>
    <div class="search-overlay"></div>

    <!--  BEGIN SIDEBAR  -->
    {% include 'sidebar.html' %}

    <!--  END SIDEBAR  -->

    <!--  BEGIN CONTENT AREA  -->
    <div id="content" class="main-content">
      <div class="layout-px-spacing">
        <div class="alert alert-success position-relative" role="alert" style="right: 0; top: 1%;display: none;" id="sucessAlert">
          Successfully Submited...
        </div>
        <div class=" layout-top-spacing">




          <div class="row layout-top-spacing layout-spacing">
            <div class="col-lg-12 ">
              <div class="statbox widget box box-shadow">

                <div class="border rounded  shadow-sm">
                  <div class="row m-1 justify-content-center">
                    <div class="col-lg-3 mt-2">
                       <div class="btn-group submitter-group ">
                        <div class="input-group-prepend">
                          <div class="input-group-text">Account Number</div>
                        </div>
                        <input type="text" class="filter-checkbox form-control-sm" id="AccountNumber" placeholder="Enter..."/>
                       
                      </div>
                    </div>
                    <div class="col-lg-3 mt-2">
                       <div class="btn-group ">
                        <div class="input-group-prepend">
                          <div class="input-group-text">MLRO</div>
                        </div>
                        <select class="form-control-sm" id="Branch">
                          <option value="">All</option>
                          <option value="Panjaguta">MLRO1</option>
                          <option value="Kukatpali">MLRO2</option>
                          <option value="KPHB">MLRO3</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-lg-3 mt-2">
                         <div class="btn-group submitter-group ">
                        <div class="input-group-prepend">
                          <div class="input-group-text">Date</div>
                        </div>
                        <input id="rangeCalendarFlatpickr" class="form-control-sm flatpickr flatpickr-input active" type="text" style="background-color: transparent !important;"
                          placeholder="Select Date Range.." />
                      </div>
                    </div>
                    <div class="col-lg-3 mt-2">
                       <div class="btn-group submitter-group ">
                        <div class="input-group-prepend">
                          <div class="input-group-text">Alert Code</div>
                        </div>
                        <select class="form-control-sm status-dropdown" id="AccType">
                          <option value="">All</option>
                          <option value="Current Account">1</option>
                          <option value="Savings Account">2</option>
                        </select>
                      </div>
                    </div>

                 </div>
                 <div class="col-12 text-center mt-1 mb-2">
                  <button id="filter-button" class="btn btn-sm btn-blue mt-3">Apply Filters</button>
                 </div>
              </div>

                <!-- <div class="form-group mb-0 widget-content widget-content-area pb-0 "
                style="display: flex;justify-content: end;align-items: center;gap: 10px;">
                <label style="font-size:20px;font-weight:500;color: #8e949d;text-wrap: nowrap;" class="mt-2">Date : </label>
                <input id="rangeCalendarFlatpickr" class="form-control flatpickr flatpickr-input active" type="text" style="background-color: transparent !important;"
                  placeholder="Select Date Range.." />
              </div> -->
                <div class="widget-content widget-content-area">
                  <div class="table-responsive mb-4 ">

                    <section>

                      <table id="example" class="display nowrap" style="width: 100%">
                        <thead>
                          <tr>
                            <th><input type="checkbox" disabled id="select-all" class="checkbox" /></th>
                            <th>Account<br>Number</th>
                            <th class="">Customer No</th>
                            <th class="d-none">Branch</th>
                            <th class="d-none">Allocated Date</th>
                            <th class="d-none">Account Type</th>
                            <th>Overall Risk Rating</th>
                            <th>Scenarios violated</th>
                            <th>No.of Transactions</th>
                            <th>Violation Amount</th>
                            <th class="d-none">Ticket ID</th>
                            

                          </tr>
                        </thead>
                        <tbody id="tableBody">
                          {% for obj in matching_objects %}
                          <tr>
                            <td></td>
                            <td><input type="checkbox" disabled class="checkbox" /></td>
                              <td>
                              <span class="{% if obj.status.cm_officer == 'Accept as STR' %}text-green{% elif obj.status.cm_officer == 'Close as NON-STR' %}text-red{% else %}text-orange{% endif %}">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-flag-filled"
                                      width="24" height="24" viewBox="0 0 24 24" 
                                      {% if obj.status.cm_officer == 'Accept as STR' %}
                                          stroke="green" fill="green"
                                      {% elif obj.status.cm_officer == 'Close as NON-STR' %}
                                          stroke="red" fill="red"
                                      {% else %}
                                          stroke="yellow" fill="orange"
                                      {% endif %}
                                      stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                      <path
                                          d="M4 5a1 1 0 0 1 .3 -.714a6 6 0 0 1 8.213 -.176l.351 .328a4 4 0 0 0 5.272 0l.249 -.227c.61 -.483 1.527 -.097 1.61 .676l.005 .113v9a1 1 0 0 1 -.300 .714a6 6 0 0 1 -8.213 .176l-.351 -.328a4 4 0 0 0 -5.136 -.114v6.552a1 1 0 0 1 -1.993 .117l-.007 -.117v-16z"
                                          stroke-width="0"></path>
                                  </svg>
                                  {{ obj.status.cm_officer }}
                              </span>
                          </td>
                          </td>
                            <td>
                              <button type="button" class="btn btn-sm btn-info" data-toggle="modal" data-target="#myModal{{obj.ticket_id}}" style="width: 30px; height: 30px; padding: 0">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="70%" height="70%" fill="currentColor"
                                  class="bi bi-eye-fill" viewBox="0 0 16 16">
                                  <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z" />
                                  <path
                                    d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" />
                                </svg>
                              
                                    </button>

                                    <button type="button" class="btn btn-sm btn-blue" data-toggle="modal" data-target="#myModal1{{obj.ticket_id}}" style="width: 30px; height: 30px; padding: 0">
                                     <svg xmlns="http://www.w3.org/2000/svg" width="70%" height="70%" fill="currentColor"
                                  class="bi bi-pencil-square" viewBox="0 0 16 16">
                                  <path
                                    d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                                  <path fill-rule="evenodd"
                                    d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
                                </svg>
                              
                                    </button>
                            </td>
                            <td>{{ obj.ticket_id }}</td>
                            
                          </tr>
                            <!-- The View Modal -->
                            <div class="modal" id="myModal{{obj.ticket_id}}" data-backdrop="false">
                              <div class="modal-dialog -lg">
                                <div class="modal-content">
                                
                                  <!-- Modal Header -->

                                   <div class="modal-header">
                                      <p class="modal-title">{{obj.ticket_id}}</p>
                                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    </div>
                                  
                                  <!-- Modal body -->
                                  <div class="modal-body">
                                   {% for key, value in obj.items() %}
                                    <div style="border-bottom: 1px solid #e6e6e6; padding: 5px 0px; font-size: 16px;">
                                        <strong style="color: #00579c; font-weight: bold;">{{ key }}</strong>:
                                        {% if key == 'status' %}
                                            <br/>
                                            {% for status_key, status_value in value.items() %}
                                                <span style="font-weight: normal;">
                                                    <div style="border-bottom: 1px solid #e6e6e6; padding: 5px 0px; font-size: 13px;">
                                                        <strong style="color: #00579c; font-weight: bold;">{{ status_key }}</strong> : {{ status_value }}<br/>
                                                    </div>
                                                </span>
                                            {% endfor %}
                                        {% elif key == 'levels' %}
                                            <br/>
                                            {% for level_key, level_value in value.items() %}
                                                <span style="font-weight: normal;">
                                                    <div style="border-bottom: 1px solid #e6e6e6; padding: 5px 0px; font-size: 13px;">
                                                        <strong style="color: #00579c; font-weight: bold;">{{ level_key }}</strong> : {{ level_value }}<br/>
                                                    </div>
                                                </span>
                                            {% endfor %}
                                        {% else %}
                                            <span style="font-weight: normal;">{{ value }}</span><br/>
                                        {% endif %}
                                    </div>
                                {% endfor %}

                                  </div>

                                  
                                  <!-- Modal footer -->
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                                  </div>
                                  
                                </div>
                              </div>
                            </div>
                            </tbody>
                          </div>

                           <!-- The Edit Modal -->
                            <div class="modal" id="myModal1{{obj.ticket_id}}" data-backdrop="false">
                              <div class="modal-dialog -lg">
                                <div class="modal-content">
                                
                                  <!-- Modal Header -->

                                   <div class="modal-header">
                                      <p class="modal-title">{{obj.ticket_id}}</p>
                                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    </div>
                                  
                                  <!-- Modal body -->
                                   <div class="modal-body">
                                   {% for key, value in obj.items() %}
                                    <div style="border-bottom: 1px solid #e6e6e6; padding: 5px 0px; font-size: 16px;">
                                        <strong style="color: #00579c; font-weight: bold;">{{ key }}</strong>:
                                        {% if key == 'status' %}
                                            <br/>
                                            {% for status_key, status_value in value.items() %}
                                                <span style="font-weight: normal;">
                                                    <div style="border-bottom: 1px solid #e6e6e6; padding: 5px 0px; font-size: 13px;">
                                                        <strong style="color: #00579c; font-weight: bold;">{{ status_key }}</strong> : {{ status_value }}<br/>
                                                    </div>
                                                </span>
                                            {% endfor %}
                                        {% elif key == 'levels' %}
                                            <br/>
                                            {% for level_key, level_value in value.items() %}
                                                <span style="font-weight: normal;">
                                                    <div style="border-bottom: 1px solid #e6e6e6; padding: 5px 0px; font-size: 13px;">
                                                        <strong style="color: #00579c; font-weight: bold;">{{ level_key }}</strong> : {{ level_value }}<br/>
                                                    </div>
                                                </span>
                                            {% endfor %}
                                        {% else %}
                                            <span style="font-weight: normal;">{{ value }}</span><br/>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                                  </div>
                                  
                                  <!-- Modal footer -->
                                  <div class="modal-footer">
                                     <form method="POST" action="{{ url_for('cm_status') }}">
                                        <input type="hidden" name="ticket_id" value="{{ obj.ticket_id }}">
                                        <button type="submit" class="btn btn-primary" name="action" value="Accept as STR">Accept as STR</button>
                                        <button type="submit" class="btn btn-danger" name="action" value="Close as NON-STR">Close as NON-STR</button>
                                    </form>
                                    
                                  </div>
                                  
                                </div>
                              </div>
                            </div>
                            
                          </div>

                         {% endfor %}
                          <!-- Add more rows with your own data as needed -->
                        </tbody>

                      </table>

                    </section>

                    <!-- modal  -->

                    <!-- Button trigger modal -->


                    <!-- Modal  view-->
                    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                      aria-hidden="true">
                      <div class="modal-dialog align-items-center">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Account Details</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                            <div id="modalContent">
                              <!-- Data from the selected row will be displayed here -->
                            </div>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                              Close
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- modal view  -->

                    <!-- modal edit  -->

                    <div class="modal fade" id="exampleeditModal" tabindex="-1" aria-labelledby="exampleeditModalLabel"
                      aria-hidden="true">
                      <div class="modal-dialog ">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Account Details</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                            <div id="modaleditContent">
                              <!-- Data from the selected row will be displayed here -->
                            </div>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-primary" id="convertToSTR"
                              data-bs-dismiss="modal">Accept as STR</button>
                            <button type="button" class="btn btn-danger" id="convertToNONSTR" data-bs-dismiss="modal">
                              Close as NON-STR
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- modal edit  -->

                    <!--  END CONTENT AREA  -->

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% include 'footer.html' %}

    </div>
  </div>
  
                  <!-- END MAIN CONTAINER -->



                  <!-- BEGIN GLOBAL MANDATORY SCRIPTS -->
                  <script src="../static/assets/js/libs/jquery-3.1.1.min.js"></script>
                  <script src="../static/bootstrap/js/popper.min.js"></script>
                  <script src="../static/bootstrap/js/bootstrap.min.js"></script>
                  <script src="../static/plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>
                  <script src="../static/assets/js/app.js"></script>

                  <!-- viwe JS start -->

                  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
                    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
                    crossorigin="anonymous"></script>
                  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/js/bootstrap.min.js"></script>


                  <!-- viwe JS ends -->


                  <script type="text/javascript" language="javascript"
                    src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
                  <script type="text/javascript" language="javascript"
                    src="https://cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>
                  <script>
                    $(document).ready(function () {
                      App.init();
                    });


                  </script>
                  <script src="../static/assets/js/custom.js"></script>
                  <!-- END GLOBAL MANDATORY SCRIPTS -->

                  <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->
                  <script src="../static/plugins/apex/apexcharts.min.js"></script>

                  <script src="../static/assets/js/dashboard/dash_1.js"></script>

                  <!-- <script src="../static/assets/js/tables.js/tableCheckBox.js"></script> -->
                  <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->

                  <script src="../static/plugins/table/datatable/datatables.js"></script>
                  <script
                  type="text/javascript"
                  language="javascript"
                  src="https://cdn.datatables.net/responsive/2.3.0/js/dataTables.responsive.min.js"
                ></script>

                  <script>


                    $(document).ready(function () {
                      dataTable = $("#example").DataTable({
                      rowReorder: {
                          selector: "td:nth-child(2)",
                        },
                        responsive: true,
                        paging: false, // Disable initial pagination
                  scrollY: "300px", // Set the height of the scrollable area
                  scrollCollapse: true, // Enable the scrollbar to collapse
                  scrollInfinite: true, // Enable infinite scrolling
                  info: true,
      });
      $(document).ready(function () {
        $("#STR, #NONSTR").on("change", function () {
          let STRCheck = $("#STR").is(":checked");
          let NONSTRCheck = $("#NONSTR").is(":checked");
          if (STRCheck && NONSTRCheck) {
            $("#submit-button").prop("disabled", false);
          } else {
            $("#submit-button").prop("disabled", true);
          }
        });
      });
      $("#STR").on("change", () => {
        let STRcheck = document.getElementById("STR").checked
        if (STRcheck) {
          let selectedData = [];
          table.rows().every(function (rowIdx, tableLoop, rowLoop) {
            let row = this.node();
            let data = this.data();
            let statusElement = $("td:eq(2) span", row);
            let statusText = statusElement.text().trim();
            if (statusText === 'Accept as STR') {
              let checkbox = $("td:eq(1) input[type='checkbox']", row);
              checkbox.prop('checked', true);
            }
          })
        }
        else {
          table.rows().every(function (rowIdx, tableLoop, rowLoop) {
            let row = this.node();
            let checkbox = $("td:eq(1) input[type='checkbox']", row);
            let statusElement = $("td:eq(2) span", row);
            let statusText = statusElement.text().trim();
            if (statusText === "Accept as STR") {
              checkbox.prop('checked', false);
            }
          });
        }
      })
      $("#NONSTR").on("change", () => {
        let approvedRows = [];
        let NONSTRcheck = document.getElementById('NONSTR').checked
        if (NONSTRcheck) {
          // Collect all the "Approved" rows
          table.rows().every(function (rowIdx, tableLoop, rowLoop) {
            let row = this.node();
            let data = this.data();
            let statusElement = $("td:eq(2) span", row);
            let statusText = statusElement.text().trim();
            if (statusText === 'Close as NON-STR') {
              let checkbox = $("td:eq(1) input[type='checkbox']", row);
              checkbox.prop('checked', true);
            }
          });
        }
        else {
          // Reset all checkboxes
          table.rows().every(function (rowIdx, tableLoop, rowLoop) {
            let row = this.node();
            let checkbox = $("td:eq(1) input[type='checkbox']", row);
            let statusElement = $("td:eq(2) span", row);
            let statusText = statusElement.text().trim();
            if (statusText === "Close as NON-STR") {
              checkbox.prop('checked', false);
            }
          });
        }
      });
      // Add a click event to the "Select All" checkbox
      $("#select-all").on("click", function () {
        let rows = table.rows({ page: "all" }).nodes();
        let allChecked = this.checked;
        $(".checkbox", rows).prop("checked", allChecked);
        table.rows({ page: "all" }).select();
      });
      // Add a click event to the submit button
      $("#select-all").on("click", function () {
        let allChecked = this.checked;
        // Check or uncheck individual checkboxes based on the "Select All" checkbox
        $(".checkbox").prop("checked", allChecked);
      });
      // Add a click event to the submit button
      $("#submit-button").on("click", function () {
        let selectedData = [];
        let notselectedData = [];
        table.rows().every(function (rowIdx, tableLoop, rowLoop) {
          let row = this.node();
          if ($("input.checkbox", row).prop("checked")) {
            let data = this.data();
            let statusElement = $("td:eq(2) span", row);
            let tokenElement = $("td:eq(4)", row);
            let tokenText = tokenElement.text()
            let statusText = statusElement.text().trim();
            selectedData.push({
              ticket_id: tokenText,
              status: statusText,
            });
          }
          else{
            let data = this.data();
            let statusElement = $("td:eq(2) span", row);
            let tokenElement = $("td:eq(4)", row);
            let tokenText = tokenElement.text()
            let statusText = statusElement.text().trim();
            if(statusText != "None")
            notselectedData.push({
              ticket_id: tokenText,
              status: statusText,
            });
          }
        });
        document.getElementById('tableBody').style.display = 'none';
        document.getElementById('sucessAlert').style.display = 'flex';
        fetch('{{ url_for("cm_submit") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify([selectedData,notselectedData])
    })
    .then(response => response.json())
    .then(data => {
        console.log('Success:', data);
        // Handle success response from the server
    })
    .catch(error => {
        console.error('Error:', error);
        // Handle error
    });
        // window.location.href = url
        setTimeout(() => {
          document.getElementById('sucessAlert').style.display = 'none'
        }, 2000)
      });
    });


                    // modal view js
                    let viewButton = document.querySelectorAll("#view");


                    for (let i = 0; i < viewButton.length; i++) {
                      viewButton[i].addEventListener("click", () => {
                        let modalContent = document.getElementById("modalContent");
                        let rowData = document.querySelectorAll("tr td span");
                        console.log(rowData[i].innerText);

                        // Extract the specific data you want to display
                        let status = rowData[i].innerText;
                        let accountNo = '123456789';
                        let id = '00112233';
                        let date = '20/12/2000';
                        let firstName = 'Mark';
                        let lastName = 'Otto';
                        let email = 'abc@mail';
                        let mobileNo = '900000100';

                        // Populate the modal content with the selected data
                        modalContent.innerHTML = `

                        <table style="width:100%">
                    <tr>
                      <td></td>
                      <th>STATUS</th>
                      <th>:</th>
                      <td>${status}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>Account NO</th>
                      <th>:</th>
                      <td>${accountNo}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>ID</th>
                      <th>:</th>
                      <td>${id}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>DATE</th>
                      <th>:</th>
                      <td>${date}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>FIRST NAME</th>
                      <th>:</th>
                      <td>${firstName}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>LAST NAME</th>
                      <th>:</th>
                      <td>${lastName}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>EMAIL</th>
                      <th>:</th>
                      <td>${email}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>MOBILE NO</th>
                      <th>:</th>
                      <td>${mobileNo}</td>
                    </tr>
                  </table>
`;
                      });
                    }
                    // modal edit js

                    let editButton = document.querySelectorAll("#edit");

                    for (let i = 0; i < editButton.length; i++) {
                      // let roweditDataTD;
                      editButton[i].addEventListener("click", (event) => {
                        let modaleditContent = document.getElementById("modaleditContent");
                        let roweditData = document.querySelectorAll("tr td span");


                        // Extract the specific data you want to display
                        let status = roweditData[i].innerText;
                        let accountNo = '123456789';
                        let id = '00112233';
                        let date = '20/12/2000';
                        let firstName = 'Mark';
                        let lastName = 'Otto';
                        let email = 'abc@mail';
                        let mobileNo = '900000100';

                        // Populate the modal content with the selected data
                        modaleditContent.innerHTML = `

                      <table style="width:100%">
                    <tr>
                      <td></td>
                      <th>STATUS</th>
                      <th>:</th>
                      <td>${status}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>Account NO</th>
                      <th>:</th>
                      <td>${accountNo}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>ID</th>
                      <th>:</th>
                      <td>${id}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>DATE</th>
                      <th>:</th>
                      <td>${date}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>FIRST NAME</th>
                      <th>:</th>
                      <td>${firstName}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>LAST NAME</th>
                      <th>:</th>
                      <td>${lastName}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>EMAIL</th>
                      <th>:</th>
                      <td>${email}</td>
                    </tr>
                    <tr>
                      <td></td>
                      <th>MOBILE NO</th>
                      <th>:</th>
                      <td>${mobileNo}</td>
                    </tr>
                  </table>

`;

                        const roweditDataTD = editButton[i].parentElement.previousElementSibling;

                        let count = 0;
                        let convertToSTR = document.getElementById('convertToSTR');
                        let countLogged = false;
                        convertToSTR.addEventListener('click', () => {
                          if (!countLogged) { // Check if count has not been logged
                            count++; // Increment the count
                            countLogged = true; // Set the flag to true
                            roweditDataTD.innerHTML = `
                             <span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-flag-filled"
                                  width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="green"
                                  fill="green" stroke-linecap="round" stroke-linejoin="round">
                                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                  <path
                                    d="M4 5a1 1 0 0 1 .3 -.714a6 6 0 0 1 8.213 -.176l.351 .328a4 4 0 0 0 5.272 0l.249 -.227c.61 -.483 1.527 -.097 1.61 .676l.005 .113v9a1 1 0 0 1 -.300 .714a6 6 0 0 1 -8.213 .176l-.351 -.328a4 4 0 0 0 -5.136 -.114v6.552a1 1 0 0 1 -1.993 .117l-.007 -.117v-16z"
                                    stroke-width="0" fill="green"></path>
                                </svg>
                                STR
                              </span>
                               `;
                          }
                          

                        })

                        let convertToNONSTR = document.getElementById('convertToNONSTR');

                        convertToNONSTR.addEventListener('click', () => {

                          if (!countLogged) { // Check if count has not been logged
                            count++; // Increment the count
                            countLogged = true; // Set the flag to true
                            roweditDataTD.innerHTML = `
                             <span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-flag-filled"
                                  width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="red"
                                  fill="green" stroke-linecap="round" stroke-linejoin="round">
                                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                  <path
                                    d="M4 5a1 1 0 0 1 .3 -.714a6 6 0 0 1 8.213 -.176l.351 .328a4 4 0 0 0 5.272 0l.249 -.227c.61 -.483 1.527 -.097 1.61 .676l.005 .113v9a1 1 0 0 1 -.300 .714a6 6 0 0 1 -8.213 .176l-.351 -.328a4 4 0 0 0 -5.136 -.114v6.552a1 1 0 0 1 -1.993 .117l-.007 -.117v-16z"
                                    stroke-width="0" fill="red"></path>
                                </svg>
                                Close STR
                              </span>
                           `;
                          }
                          
                        })
                      });
                    }

                    let deleteButton = document.querySelectorAll("#delete");

                    for (let i = 0; i < deleteButton.length; i++) {
                      deleteButton[i].addEventListener("click", () => {
                        let roweditData = document.querySelectorAll("tr");
                        roweditData[i + 1].style.display = "none"

                      })

                    }

      // date picker Starts

      document.addEventListener("DOMContentLoaded", function () {
        var f3 = flatpickr(document.getElementById("rangeCalendarFlatpickr"), {
          mode: "range",
          onClose: function (selectedDates, dateStr, instance) {
            if (selectedDates.length === 2) {
              instance.close();
            }
          },
        });
      });

      // date picker ENds


                  </script>
                 <!-- <script>
                  $(document).ready(function () {
                      var isNavigatingAway = false;
                
                      // Update the user's active status every minute
                      setInterval(function () {
                          if (!isNavigatingAway) {
                              $.ajax({
                                  type: "POST",
                                  url: "/update_active_status",
                                  success: function (response) {
                                      console.log("Active status updated");
                                  },
                                  error: function (xhr, status, error) {
                                      console.error("Error updating active status:", error);
                                  }
                              });
                          }
                      }, 60000); // 1 minute interval
                
                      // Add event listener for click events on links
                      $(document).on('click', 'a', function () {
                          isNavigatingAway = true;
                      });
                
                      // Add event listener for form submit events
                      $(document).on('submit', 'form', function () {
                          isNavigatingAway = true;
                      });
                
                      // Send a Beacon request when the tab is closed
                      window.addEventListener('pagehide', function () {
                          if (!isNavigatingAway) {
                              navigator.sendBeacon('/update_status');
                              console.log("Status updated to null via Beacon");
                          }
                      });
                      
                  });
                
                </script> -->

</body>

</html>